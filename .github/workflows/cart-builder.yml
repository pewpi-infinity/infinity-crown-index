name: ðŸ›’ Cart Directory Builder

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:

jobs:
  build-carts:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Cart Directory
        run: |
          python3 <<'EOPY'
import json
import requests

USER = "pewpi-infinity"

# Find all C13B0 carts
carts = []

page = 1
while page < 15:
    r = requests.get(f"https://api.github.com/search/code?q=c13b0+user:{USER}&per_page=100&page={page}")
    if r.status_code != 200:
        break
    
    data = r.json()
    items = data.get('items', [])
    
    if not items:
        break
    
    for item in items:
        if 'c13b0' in item['name'].lower():
            carts.append({
                "name": item['name'],
                "repo": item['repository']['name'],
                "url": item['html_url']
            })
    
    page += 1

with open("api/carts.json", "w") as f:
    json.dump(carts, f, indent=2)

print(f"ðŸ›’ Found {len(carts)} C13B0 carts")
EOPY
      
      - name: Commit
        run: |
          git config user.name "Cart Bot"
          git config user.email "cart@infinity.ai"
          git add api/carts.json
          git commit -m "ðŸ›’ Cart build ${{ github.run_number }}"
          git push
