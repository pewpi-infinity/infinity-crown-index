<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
<title>Infinity Crown Index</title>
<meta name="description" content="Central command for the Infinity ecosystem — 980+ repos, machines, tools"/>
<style>
:root{--bg:#060a10;--sf:#0d1117;--cd:#151b25;--bd:#1e2836;--ac:#8b5cf6;--ac2:#6c63ff;--gold:#f5c542;--grn:#10b981;--txt:#e6edf3;--dim:#6e7681;--red:#ef4444;--blue:#3b82f6}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,sans-serif;line-height:1.5;overflow-x:hidden}
a{color:var(--ac);text-decoration:none}a:hover{text-decoration:underline}
.hdr{background:var(--sf);border-bottom:2px solid var(--ac);padding:10px 16px;position:sticky;top:0;z-index:100}
.hdr-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap;max-width:1200px;margin:0 auto}
.brand{font-weight:800;font-size:1.15rem;white-space:nowrap}
.brand em{color:var(--gold);font-style:normal}
.search-box{flex:1;min-width:180px;max-width:400px;position:relative}
.search-box input{width:100%;background:var(--cd);border:1px solid var(--bd);border-radius:8px;padding:7px 12px 7px 32px;color:var(--txt);font-size:0.85rem;outline:none}
.search-box input:focus{border-color:var(--ac)}
.search-icon{position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:0.8rem}
.nav{display:flex;gap:4px;flex-wrap:wrap}
.nav a{font-size:0.72rem;padding:4px 10px;border:1px solid var(--bd);border-radius:6px;color:var(--txt);white-space:nowrap;transition:all 0.15s}
.nav a:hover{background:rgba(139,92,246,.15);border-color:var(--ac);text-decoration:none}
.stats{display:flex;gap:8px;flex-wrap:wrap;padding:12px 16px;max-width:1200px;margin:0 auto}
.stat{background:var(--cd);border:1px solid var(--bd);border-radius:10px;padding:8px 14px;text-align:center;min-width:90px}
.stat strong{display:block;font-size:1.2rem;color:var(--gold)}
.stat span{font-size:0.65rem;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px}
.cats{display:flex;gap:4px;flex-wrap:wrap;padding:8px 16px;max-width:1200px;margin:0 auto}
.cat-btn{background:var(--cd);border:1px solid var(--bd);border-radius:20px;padding:4px 12px;font-size:0.72rem;color:var(--dim);cursor:pointer;transition:all 0.15s;white-space:nowrap}
.cat-btn:hover,.cat-btn.on{background:var(--ac);color:#fff;border-color:var(--ac)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:10px;padding:12px 16px;max-width:1200px;margin:0 auto}
.card{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:12px;transition:border-color 0.15s}
.card:hover{border-color:var(--ac)}
.card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.card-name{font-weight:700;font-size:0.85rem;color:var(--txt);word-break:break-all}
.card-tag{font-size:0.6rem;padding:2px 8px;border-radius:10px;background:rgba(139,92,246,.15);color:var(--ac);white-space:nowrap}
.card-url{font-size:0.7rem;color:var(--dim);margin-bottom:6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.card-url a{color:var(--dim)}
.card-url a:hover{color:var(--ac)}
.card-badges{display:flex;gap:4px;flex-wrap:wrap}
.badge{font-size:0.6rem;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,.04);color:var(--dim);border:1px solid var(--bd);text-decoration:none}
.badge.on{background:rgba(16,185,129,.1);color:var(--grn);border-color:rgba(16,185,129,.3)}
.badge:hover{border-color:var(--ac);text-decoration:none}
.hubs{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;padding:12px 16px;max-width:1200px;margin:0 auto}
.hub{background:linear-gradient(135deg,var(--cd),var(--sf));border:1px solid var(--bd);border-radius:12px;padding:14px;text-align:center;transition:all 0.2s;cursor:pointer;text-decoration:none;color:var(--txt)}
.hub:hover{border-color:var(--gold);transform:translateY(-2px);text-decoration:none}
.hub-icon{font-size:1.8rem;display:block;margin-bottom:4px}
.hub-name{font-weight:700;font-size:0.8rem}
.hub-desc{font-size:0.6rem;color:var(--dim);margin-top:2px}
.sec{padding:12px 16px 4px;max-width:1200px;margin:0 auto}
.sec h2{font-size:0.9rem;color:var(--gold);border-bottom:1px solid var(--bd);padding-bottom:4px}
.footer{text-align:center;padding:20px 16px;font-size:0.65rem;color:var(--dim);border-top:1px solid var(--bd);margin-top:20px}
.loading{text-align:center;padding:40px;color:var(--dim)}
.spin{display:inline-block;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.count{font-size:0.75rem;color:var(--dim);white-space:nowrap}
</style>
</head>
<body>

<div class="hdr">
  <div class="hdr-row">
    <div class="brand"><em>&#x221E;</em> Crown Index</div>
    <div class="search-box"><span class="search-icon">&#x1F50D;</span><input id="q" placeholder="Search 980+ repos..." autocomplete="off"/></div>
    <div class="nav">
      <a href="https://pewpi-infinity.github.io/infinity-master-hub/">&#x1F310; Hub</a>
      <a href="https://pewpi-infinity.github.io/infinity-spark-market/">&#x1F4B0; Market</a>
      <a href="https://pewpi-infinity.github.io/smug_look/">&#x1F9F1; Octave</a>
      <a href="https://pewpi-infinity.github.io/mongoose.os/">&#x1F9F2; MOS</a>
      <a href="https://pewpi-infinity.github.io/MARIO-TOKENS/">&#x1F3AE; Mario</a>
      <a href="https://pewpi-infinity.github.io/infinity-tools/">&#x1F527; Tools</a>
      <a href="https://pewpi-infinity.github.io/DJVertigo-token/">&#x1F9BE; DJV</a>
    </div>
    <div class="count" id="count"></div>
  </div>
</div>

<div class="sec"><h2>&#x1F451; Command Hubs</h2></div>
<div class="hubs" id="hubs"></div>

<div class="sec"><h2>&#x1F4CA; System Status</h2></div>
<div class="stats" id="stats"></div>

<div class="sec"><h2>&#x1F3F7;&#xFE0F; Categories</h2></div>
<div class="cats" id="cats"></div>

<div class="sec"><h2>&#x1F4E6; Repositories</h2></div>
<div class="grid" id="grid"><div class="loading"><span class="spin">&#x2699;</span> Loading repos...</div></div>

<div class="footer">
  Infinity Crown Index &mdash; 980+ repositories &mdash; Part of the <a href="https://pewpi-infinity.github.io/infinity-master-hub/">Infinity Ecosystem</a><br/>
  Contact: 808-342-9975 &middot; marvasweater@gmail.com
</div>

<script>
(function(){
  "use strict";
  var USER = "pewpi-infinity";
  var BASE = "https://" + USER + ".github.io";

  var HUBS = [
    {name:"infinity-crown-index",icon:"\u{1F451}",label:"Crown Index",desc:"You are here"},
    {name:"infinity-master-hub",icon:"\u{1F310}",label:"Master Hub",desc:"Global navigation"},
    {name:"infinity-spark-market",icon:"\u{1F4B0}",label:"Marketplace",desc:"Components & trade"},
    {name:"infinity-tools",icon:"\u{1F527}",label:"Tools",desc:"Upload & scripts"},
    {name:"mongoose.os",icon:"\u{1F9F2}",label:"Mongoose OS",desc:"Research database"},
    {name:"smug_look",icon:"\u{1F9F1}",label:"Octave",desc:"C13B0 system"},
    {name:"MARIO-TOKENS",icon:"\u{1F3AE}",label:"Mario Tokens",desc:"Token system"},
    {name:"DJVertigo-token",icon:"\u{1F9BE}",label:"DJVertigo",desc:"DJV dashboard"}
  ];

  var sites = [];
  var activeFilter = null;

  function renderHubs() {
    var el = document.getElementById("hubs");
    el.innerHTML = HUBS.map(function(h) {
      return '<a class="hub" href="' + BASE + '/' + h.name + '/">' +
        '<span class="hub-icon">' + h.icon + '</span>' +
        '<div class="hub-name">' + h.label + '</div>' +
        '<div class="hub-desc">' + h.desc + '</div></a>';
    }).join("");
  }

  async function loadData() {
    try {
      var r = await fetch("data/crown_sites.json", {cache:"no-store"});
      if (r.ok) sites = await r.json();
    } catch(e) {
      console.warn("crown_sites load error:", e);
    }
    if (!sites.length) {
      document.getElementById("grid").innerHTML = '<div class="loading">No data — check data/crown_sites.json</div>';
      return;
    }
    renderStats();
    renderCategories();
    renderGrid();
  }

  function renderStats() {
    var total = sites.length;
    var withPages = sites.filter(function(s){ return s.crowned || s.has_pages; }).length;
    var cats = {};
    sites.forEach(function(s){ var c = getCategory(s.repo || s.name || ""); cats[c] = 1; });
    document.getElementById("stats").innerHTML =
      stat(total, "Total Repos") +
      stat(withPages, "Crowned") +
      stat(Object.keys(cats).length, "Categories") +
      stat(HUBS.length, "Hub Repos");
  }

  function stat(val, label) {
    return '<div class="stat"><strong>' + val + '</strong><span>' + label + '</span></div>';
  }

  function getCategory(name) {
    if (!name) return "other";
    var n = name.toLowerCase();
    if (n.startsWith("infinity-spark")) return "spark";
    if (n.startsWith("infinity-brain")) return "brain";
    if (n.startsWith("infinity-")) return "infinity";
    if (n.startsWith("b55-")) return "b55";
    if (n.startsWith("diodes")) return "diodes";
    if (n.startsWith("cart_")) return "cart";
    if (n.indexOf("sim-") >= 0) return "sim";
    if (n.indexOf("rotation") >= 0) return "rotation";
    if (n.indexOf("vision") >= 0) return "vision";
    if (n.indexOf("helium") >= 0) return "helium";
    return "other";
  }

  function renderCategories() {
    var counts = {};
    sites.forEach(function(s) {
      var cat = getCategory(s.repo || s.name || "");
      counts[cat] = (counts[cat] || 0) + 1;
    });
    var sorted = Object.entries(counts).sort(function(a,b){ return b[1] - a[1]; });
    var html = '<button class="cat-btn' + (!activeFilter ? ' on' : '') + '" onclick="window._filter(null)">All (' + sites.length + ')</button>';
    sorted.forEach(function(pair) {
      var cat = pair[0], count = pair[1];
      html += '<button class="cat-btn' + (activeFilter === cat ? ' on' : '') + '" onclick="window._filter(\'' + cat + '\')">' + cat + ' (' + count + ')</button>';
    });
    document.getElementById("cats").innerHTML = html;
  }

  window._filter = function(cat) {
    activeFilter = activeFilter === cat ? null : cat;
    renderCategories();
    renderGrid();
  };

  function renderGrid() {
    var query = (document.getElementById("q").value || "").toLowerCase();
    var filtered = sites.filter(function(s) {
      var name = (s.repo || s.name || "").toLowerCase();
      var cat = getCategory(name);
      var matchQ = !query || name.indexOf(query) >= 0 || cat.indexOf(query) >= 0;
      var matchCat = !activeFilter || cat === activeFilter;
      return matchQ && matchCat;
    });

    document.getElementById("count").textContent = filtered.length + " / " + sites.length + " repos";

    if (!filtered.length) {
      document.getElementById("grid").innerHTML = '<div class="loading">No matching repos</div>';
      return;
    }

    var shown = filtered.slice(0, 200);
    document.getElementById("grid").innerHTML = shown.map(function(s) {
      var name = s.repo || s.name || "unknown";
      var url = s.url || (BASE + "/" + name + "/");
      var cat = getCategory(name);
      var crowned = s.crowned ? '<span class="badge on">crowned</span>' : '';
      return '<div class="card">' +
        '<div class="card-top"><span class="card-name">' + name + '</span><span class="card-tag">' + cat + '</span></div>' +
        '<div class="card-url"><a href="' + url + '" target="_blank">' + url + '</a></div>' +
        '<div class="card-badges">' + crowned +
        '<a class="badge" href="https://github.com/' + USER + '/' + name + '" target="_blank">GitHub</a> ' +
        '<a class="badge" href="' + url + '" target="_blank">Visit</a></div></div>';
    }).join("") + (filtered.length > 200 ? '<div class="loading">Showing 200 of ' + filtered.length + ' — search to narrow</div>' : '');
  }

  document.getElementById("q").addEventListener("input", renderGrid);
  renderHubs();
  loadData();
})();
</script>
</body>
</html>
